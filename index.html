Yesterdays records ==

hive> select * from hive_final;
OK
1	Arvik	10000
2	Shyam	20000
3	Ram	30000
4	Sonu	40000
5	Archana	50000
6	vikesh	60000
Time taken: 0.135 seconds, Fetched: 6 row(s)
hive> 


Todays new records ==

mysql> select * from table1;
+------+---------+-------+
| eno  | ename   | esal  |
+------+---------+-------+
|    5 | Archana | 55555 |
|    6 | vicky   | 99999 |
|    7 | Sam     | 70000 |
|    8 | Tom     | 80000 |
+------+---------+-------+
4 rows in set (0.00 sec)

mysql> 

gopalkrishna@ubuntu:~$ sqoop job --exec task_1;

hive> select * from table1;
OK
5	Archana	55555
6	vicky	99999
7	Sam	70000
8	Tom	80000
Time taken: 2.982 seconds, Fetched: 4 row(s)
hive> 

Script to perform lncreamental import with updated records,newly added records and keep old records as it is -

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

!echo " ************************************** ";

!echo "SQOOP TASK STARTED";

!echo " ************************************** ";


use default;

SET hive.cli.print.header=true;

SET hive.cli.print.current.db=true;


!echo " ************************************** ";

!echo " SQOOP IMPORTED UPDATED DATA FROM MYSQL TO HIVE 'TABLE1' ";

!echo " ************************************** ";



select * from table1 ;



!echo " ************************************** ";

!echo "  CREATING INTERMEDIATE TABLE 'TABLE2'  CTAS AS 'TABLE1'";

!echo " ************************************** ";



create table table2 as select eno,ename,esal from table1; 



!echo " ************************************** ";

!echo "  VIEWING DATA FROM INTERMEDIATE TABLE 'TABLE2'";

!echo " ************************************** ";



select * from table2 ;



!echo " ************************************** ";
!echo "DELETING SQOOP IMPORT TO HIVE TABLE 'TABLE1'";
!echo " ************************************** ";


drop table table1; 


!echo " ************************************** ";

!echo "  CREATING INTERMEDIATE TABLE 'TABLE1'  CTAS AS 'HIVE_FINAL'";

!echo " ************************************** ";



create table table1 as select eno,ename,esal from hive_final; 



!echo " ************************************** ";

!echo "INSERTING UPDATED RECORDS INTO MAIN HIVE TABLE 'HIVE_FINAL'";

!echo " ************************************** ";



insert overwrite table hive_final select b.eno,b.ename,b.esal from table2 b left outer join table1 a on (a.eno=b.eno) where b.eno is not null;



!echo " ************************************** ";

!echo "INSERTING OLD RECORDS INTO MAIN HIVE TABLE 'HIVE_FINAL'";

!echo " ************************************** ";



insert into table hive_final select a.eno,a.ename,a.esal from table2 b right outer join table1 a on (a.eno=b.eno) where b.eno is null or a.eno is null;



!echo " ************************************** ";

!echo "  VIEWING DATA FROM MAIN HIVE TABLE TABLE 'HIVE_FINAL'";

!echo " ************************************** ";



select * from hive_final sort by eno;


!echo " ************************************** ";
!echo "DELETING OLD INTERMEDIATE TABLE 'TABLE1'";
!echo " ************************************** ";


drop table table1; 


!echo " ************************************** ";
!echo "DELETING OLD INTERMEDIATE TABLE 'TABLE2'";
!echo " ************************************** ";


drop table table2; 



!echo " ************************************** ";

!echo "  TASK END ";

!echo " ************************************** ";
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Execution of hql script -

gopalkrishna@ubuntu:~$ hive -f task_script.hql

" ************************************** "
"SQOOP TASK STARTED"
" ************************************** "
OK
Time taken: 1.379 seconds
" ************************************** "
" SQOOP IMPORTED UPDATED DATA FROM MYSQL TO HIVE 'TABLE1' "
" ************************************** "
OK
table1.eno	table1.ename	table1.esal
5	Archana	55555
6	vicky	99999
7	Sam	70000
8	Tom	80000
Time taken: 0.884 seconds, Fetched: 4 row(s)
" ************************************** "
" CREATING INTERMEDIATE TABLE 'TABLE2' CTAS AS 'TABLE1'"
" ************************************** "

OK
eno	ename	esal
Time taken: 19.632 seconds
" ************************************** "
" VIEWING DATA FROM INTERMEDIATE TABLE 'TABLE2'"
" ************************************** "
OK
table2.eno	table2.ename	table2.esal
5	Archana	55555
6	vicky	99999
7	Sam	70000
8	Tom	80000
Time taken: 0.136 seconds, Fetched: 4 row(s)
" ************************************** "
"DELETING SQOOP IMPORT TO HIVE TABLE 'TABLE1'"
" ************************************** "
OK
Time taken: 0.595 seconds
" ************************************** "
" CREATING INTERMEDIATE TABLE 'TABLE1' CTAS AS 'HIVE_FINAL'"
" ************************************** "
OK
eno	ename	esal
Time taken: 16.069 seconds
" ************************************** "
"INSERTING UPDATED RECORDS INTO MAIN HIVE TABLE 'HIVE_FINAL'"
" ************************************** "

OK
b.eno	b.ename	b.esal
Time taken: 26.358 seconds
" ************************************** "
"INSERTING OLD RECORDS INTO MAIN HIVE TABLE 'HIVE_FINAL'"
" ************************************** "

OK
a.eno	a.ename	a.esal
Time taken: 24.907 seconds
" ************************************** "
" VIEWING DATA FROM MAIN HIVE TABLE TABLE 'HIVE_FINAL'"
" ************************************** "
OK
hive_final.eno	hive_final.ename	hive_final.esal
1	Arvik	10000
2	Shyam	20000
3	Ram	30000
4	Sonu	40000
5	Archana	55555
6	vicky	99999
7	Sam	70000
8	Tom	80000
Time taken: 25.201 seconds, Fetched: 8 row(s)
" ************************************** "
"DELETING OLD INTERMEDIATE TABLE 'TABLE1'"
" ************************************** "
OK
Time taken: 0.148 seconds
" ************************************** "
"DELETING OLD INTERMEDIATE TABLE 'TABLE2'"
" ************************************** "
OK
Time taken: 0.136 seconds
" ************************************** "
" TASK END "
" ************************************** "

